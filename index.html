<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>á€›á€•á€ºáŠá€€á€¼á€Šá€·á€ºáŠá€á€½á€¬á€¸ - 5 Steps Edition</title>
    <style>
        body { text-align: center; background-color: #1a1a1a; color: white; font-family: sans-serif; margin: 0; touch-action: none; overflow: hidden; }
        #gameCanvas { background-color: #222; border: 3px solid #444; max-width: 95%; height: auto; display: none; margin: 5px auto; }
        .stats { font-size: 18px; margin: 10px 0; color: #f1c40f; }
        .controls { display: grid; grid-template-columns: repeat(3, 75px); grid-gap: 15px; justify-content: center; margin-top: 10px; }
        .ctrl-btn { width: 75px; height: 75px; background: rgba(255,255,255,0.2); border: 3px solid white; border-radius: 50%; color: white; font-size: 32px; display: flex; align-items: center; justify-content: center; user-select: none; -webkit-tap-highlight-color: transparent; cursor: pointer; }
        .ctrl-btn:active { background: rgba(255,255,255,0.6); transform: scale(0.9); }
        .up { grid-column: 2; }
        .left { grid-column: 1; }
        .down { grid-column: 2; }
        .right { grid-column: 3; }
        .btn { padding: 15px 40px; font-size: 22px; cursor: pointer; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="startScreen" style="padding-top: 50px; display: block;">
        <h1>ğŸ›‘ á€›á€•á€ºáŠá€€á€¼á€Šá€·á€ºáŠá€á€½á€¬á€¸ ğŸš¶â€â™‚ï¸</h1>
        <p>á€™á€»á€‰á€ºá€¸á€á€…á€ºá€€á€¼á€±á€¬á€„á€ºá€¸á€€á€¼á€¬á€¸ á… á€œá€¾á€™á€ºá€¸ á€œá€»á€¾á€±á€¬á€€á€ºá€™á€šá€ºá€Ÿá€»á€±á€¬á€„á€·á€º!</p>
        <button class="btn" onclick="startGame()">á€‚á€­á€™á€ºá€¸á€…á€†á€±á€¬á€·á€™á€šá€º</button>
    </div>

    <div id="gameUI" style="display:none;">
        <div class="stats">á€™á€¾á€á€ºá€…á€¯: <span id="scoreVal">0</span> | á€¡á€†á€„á€·á€º: <span id="levelVal">1</span></div>
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        <div class="controls">
            <div id="btn-up" class="ctrl-btn up">â–²</div>
            <div id="btn-left" class="ctrl-btn left">â—€</div>
            <div id="btn-down" class="ctrl-btn down">â–¼</div>
            <div id="btn-right" class="ctrl-btn right">â–¶</div>
        </div>
    </div>

    <script>
        let canvas, ctx, playerImg, car1Img, car2Img, goalImg;
        let moveSound, crashSound, winSound;
        let score = 0, level = 1, gameStarted = false;
        
        const laneLines = [85, 195, 305, 415, 525];
        const laneCenters = [140, 250, 360, 470];
        let player = { x: 85 - 17, y: 180, width: 35, height: 35 };

        let cars = [
            { x: 140 - 20, y: 0, w: 40, h: 65, speed: 2.3, type: 1 },
            { x: 250 - 20, y: 100, w: 40, h: 65, speed: -3.0, type: 2 },
            { x: 360 - 20, y: 200, w: 40, h: 65, speed: 3.5, type: 1 },
            { x: 470 - 20, y: 50, w: 40, h: 65, speed: -2.5, type: 2 }
        ];

        function startGame() {
            canvas = document.getElementById("gameCanvas");
            ctx = canvas.getContext("2d");
            playerImg = new Image(); playerImg.src = 'player.png';
            car1Img = new Image(); car1Img.src = 'car1.png';
            car2Img = new Image(); car2Img.src = 'car2.png';
            goalImg = new Image(); goalImg.src = 'goal.png';
            moveSound = new Audio('move.mp3');
            crashSound = new Audio('crash.mp3');
            winSound = new Audio('win.mp3');

            document.getElementById("startScreen").style.display = "none";
            document.getElementById("gameUI").style.display = "block";
            canvas.style.display = "block";
            
            if (!gameStarted) {
                setupControls();
                gameStarted = true;
                requestAnimationFrame(gameLoop);
            }
        }

        function move(dir) {
            if (!gameStarted) return;
            moveSound.currentTime = 0;
            moveSound.play().catch(e => {});

            // ááá€ á€•á€…á€ºá€‡á€šá€ºá€€á€­á€¯ á… á€œá€¾á€™á€ºá€¸á€”á€²á€·á€á€½á€¬á€¸á€›á€„á€º á€á€…á€ºá€œá€¾á€™á€ºá€¸á€€á€­á€¯ á‚á‚ á€•á€…á€ºá€‡á€šá€º
            let stepX = 22; 
            let stepY = 25; // á€¡á€•á€±á€«á€ºá€¡á€±á€¬á€€á€ºá€€á€­á€¯á€œá€Šá€ºá€¸ á€”á€Šá€ºá€¸á€”á€Šá€ºá€¸á€•á€­á€¯á€á€»á€±á€¬á€™á€½á€±á€·á€¡á€±á€¬á€„á€º á€œá€»á€¾á€±á€¬á€·á€œá€­á€¯á€€á€ºá€á€šá€º

            if (dir === "up") player.y -= stepY;
            if (dir === "down") player.y += stepY;
            if (dir === "left") player.x -= stepX;
            if (dir === "right") player.x += stepX;

            // Smart Snapping: á€™á€»á€‰á€ºá€¸á€”á€¬á€¸á€¡á€›á€™á€ºá€¸á€€á€•á€ºá€á€½á€¬á€¸á€™á€¾ á€€á€½á€€á€ºá€á€­á€€á€•á€ºá€•á€±á€¸á€™á€¾á€¬
            laneLines.forEach(lineX => {
                let targetX = lineX - 17;
                if (Math.abs(player.x - targetX) < 10) {
                    player.x = targetX;
                }
            });

            // Boundaries
            if (player.x < 10) player.x = 10;
            if (player.y < 0) player.y = 0;
            if (player.y > 365) player.y = 365;
            if (player.x > 565) player.x = 565;
        }

        function setupControls() {
            const btns = [
                {id:'btn-up', d:'up'}, {id:'btn-down', d:'down'},
                {id:'btn-left', d:'left'}, {id:'btn-right', d:'right'}
            ];
            btns.forEach(b => {
                const el = document.getElementById(b.id);
                if (el) {
                    const handle = (e) => { e.preventDefault(); move(b.d); };
                    el.addEventListener('touchstart', handle, {passive: false});
                    el.addEventListener('mousedown', handle);
                }
            });
        }

        window.addEventListener("keydown", (e) => {
            if (gameStarted) {
                if (e.key === "ArrowUp") move("up");
                if (e.key === "ArrowDown") move("down");
                if (e.key === "ArrowLeft") move("left");
                if (e.key === "ArrowRight") move("right");
            }
        });

        function gameLoop() {
            if (!gameStarted) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#333"; ctx.fillRect(80, 0, 460, 400);
            
            ctx.strokeStyle = "#fff"; ctx.lineWidth = 2; ctx.setLineDash([15, 15]);
            laneLines.forEach(x => {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, 400); ctx.stroke();
            });
            ctx.setLineDash([]);

            if (goalImg.complete) ctx.drawImage(goalImg, 550, 180, 40, 40);
            if (playerImg.complete) ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);

            cars.forEach(car => {
                car.y += car.speed;
                if (car.y > canvas.height) car.y = -80;
                if (car.y < -80) car.y = canvas.height;
                
                let currentImg = (car.type === 1) ? car1Img : car2Img;
                if (currentImg.complete) {
                    ctx.save();
                    if(car.speed < 0) {
                        ctx.translate(car.x + car.w/2, car.y + car.h/2); ctx.rotate(Math.PI);
                        ctx.drawImage(currentImg, -car.w/2, -car.h/2, car.w, car.h);
                    } else { ctx.drawImage(currentImg, car.x, car.y, car.w, car.h); }
                    ctx.restore();
                }

                let pX = 12, pY = 10;
                if (player.x + pX < car.x + car.w - pX && player.x + player.width - pX > car.x + pX &&
                    player.y + pY < car.y + car.h - pY && player.y + player.height - pY > car.y + pY) {
                    crashSound.play().catch(e => {});
                    alert("á€€á€¬á€¸á€á€­á€¯á€€á€ºá€á€½á€¬á€¸á€•á€¼á€®!");
                    score = 0; level = 1; updateUI(); resetPlayer();
                }
            });

            if (player.x >= 540) {
                winSound.play().catch(e => {});
                score += 10;
                if (score % 50 === 0) { level += 1; cars.forEach(c => c.speed *= 1.12); }
                updateUI(); resetPlayer();
            }
            requestAnimationFrame(gameLoop);
        }

        function resetPlayer() { player.x = laneLines[0] - 17; player.y = 180; }
        function updateUI() {
            document.getElementById("scoreVal").innerText = score;
            document.getElementById("levelVal").innerText = level;
        }
    </script>
</body>
</html>